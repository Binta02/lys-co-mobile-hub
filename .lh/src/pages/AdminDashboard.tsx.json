{
    "sourceFile": "src/pages/AdminDashboard.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1749066281353,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1749068823447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,10 +88,8 @@\n   };\r\n \r\n   return (\r\n     <div className=\"p-6\">\r\n-      <h1 className=\"text-2xl font-bold mb-4\">Tableau de bord Admin</h1>\r\n-\r\n       <div className=\"flex flex-wrap gap-6\">\r\n         <div className=\"w-full md:w-1/3\">\r\n           <h2 className=\"font-semibold mb-2\">Clients</h2>\r\n           <ul className=\"border rounded p-2 h-[400px] overflow-auto\">\r\n"
                },
                {
                    "date": 1749068954781,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,84 +86,137 @@\n     if (error) console.error(\"Erreur suppression\", error);\r\n     else setDocuments((prev) => prev.filter((doc) => doc.id !== docId));\r\n   };\r\n \r\n-  return (\r\n-    <div className=\"p-6\">\r\n-      <div className=\"flex flex-wrap gap-6\">\r\n-        <div className=\"w-full md:w-1/3\">\r\n-          <h2 className=\"font-semibold mb-2\">Clients</h2>\r\n-          <ul className=\"border rounded p-2 h-[400px] overflow-auto\">\r\n+return (\r\n+  <div className=\"p-8 bg-gray-50 min-h-screen\">\r\n+    <div className=\"max-w-7xl mx-auto\">\r\n+      <h1 className=\"text-3xl font-bold text-gray-800 mb-6\">\r\n+        Gestion des clients et de leurs documents\r\n+      </h1>\r\n+\r\n+      <div className=\"flex flex-col lg:flex-row gap-8\">\r\n+        {/* Liste des clients */}\r\n+        <div className=\"w-full lg:w-1/3 bg-white shadow rounded-lg p-6\">\r\n+          <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">Clients</h2>\r\n+          <ul className=\"divide-y divide-gray-200 max-h-[500px] overflow-y-auto\">\r\n             {clients.map((client) => (\r\n               <li\r\n                 key={client.id}\r\n-                className={`p-2 cursor-pointer hover:bg-gray-100 ${\r\n-                  selectedClient?.id === client.id ? \"bg-gray-200\" : \"\"\r\n-                }`}\r\n+                className={`\r\n+                  flex flex-col \r\n+                  py-3 px-4 rounded-md mb-2 cursor-pointer transition-colors duration-150\r\n+                  ${selectedClient?.id === client.id\r\n+                    ? \"bg-blue-50 border-l-4 border-blue-500\"\r\n+                    : \"hover:bg-gray-100\"}\r\n+                `}\r\n                 onClick={() => setSelectedClient(client)}\r\n               >\r\n-                {client.first_name} {client.last_name} <br />\r\n-                <span className=\"text-sm text-gray-600\">{client.email}</span>\r\n+                <div className=\"flex items-center justify-between\">\r\n+                  <span className=\"text-gray-800 font-medium\">\r\n+                    {client.first_name} {client.last_name}\r\n+                  </span>\r\n+                  {selectedClient?.id === client.id && (\r\n+                    <svg\r\n+                      xmlns=\"http://www.w3.org/2000/svg\"\r\n+                      className=\"h-5 w-5 text-blue-500\"\r\n+                      viewBox=\"0 0 20 20\"\r\n+                      fill=\"currentColor\"\r\n+                    >\r\n+                      <path\r\n+                        fillRule=\"evenodd\"\r\n+                        d=\"M16.707 5.293a1 1 0 00-1.414 0L9 11.586 6.707 9.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l7-7a1 1 0 000-1.414z\"\r\n+                        clipRule=\"evenodd\"\r\n+                      />\r\n+                    </svg>\r\n+                  )}\r\n+                </div>\r\n+                <span className=\"text-sm text-gray-500 mt-1\">{client.email}</span>\r\n               </li>\r\n             ))}\r\n+            {clients.length === 0 && (\r\n+              <li className=\"py-4 text-center text-gray-400\">Aucun client trouvé.</li>\r\n+            )}\r\n           </ul>\r\n         </div>\r\n \r\n+        {/* Détails du client sélectionné */}\r\n         {selectedClient && (\r\n-          <div className=\"w-full md:w-2/3\">\r\n-            <h2 className=\"font-semibold mb-2\">\r\n-              Documents de {selectedClient.first_name}{\" \"}\r\n-              {selectedClient.last_name}\r\n-            </h2>\r\n+          <div className=\"w-full lg:w-2/3 space-y-6\">\r\n+            <div className=\"bg-white shadow rounded-lg p-6\">\r\n+              <h2 className=\"text-xl font-semibold text-gray-700 mb-4\">\r\n+                Documents de{\" \"}\r\n+                <span className=\"text-blue-600\">\r\n+                  {selectedClient.first_name} {selectedClient.last_name}\r\n+                </span>\r\n+              </h2>\r\n \r\n-            <div className=\"mb-4\">\r\n-              <input\r\n-                type=\"file\"\r\n-                onChange={(e) => setFile(e.target.files?.[0] || null)}\r\n-              />\r\n-              <button\r\n-                className=\"ml-2 px-4 py-1 bg-blue-600 text-white rounded\"\r\n-                onClick={handleUpload}\r\n-              >\r\n-                Upload\r\n-              </button>\r\n-            </div>\r\n+              {/* Zone d’upload */}\r\n+              <div className=\"flex flex-col sm:flex-row sm:items-center gap-4 mb-6\">\r\n+                <input\r\n+                  type=\"file\"\r\n+                  className=\"block w-full sm:w-auto text-gray-600 file:mr-4 file:py-2 file:px-4\r\n+                             file:rounded file:border-0 file:text-sm file:font-semibold\r\n+                             file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100\"\r\n+                  onChange={(e) => setFile(e.target.files?.[0] || null)}\r\n+                />\r\n+                <button\r\n+                  className=\"w-full sm:w-auto px-6 py-2 bg-blue-600 text-white font-medium rounded-lg\r\n+                             shadow hover:bg-blue-700 transition-colors duration-150\"\r\n+                  onClick={handleUpload}\r\n+                >\r\n+                  Upload\r\n+                </button>\r\n+              </div>\r\n \r\n-            {documents.length === 0 ? (\r\n-              <p>Aucun document</p>\r\n-            ) : (\r\n-              <ul className=\"space-y-3\">\r\n-                {documents.map((doc) => (\r\n-                  <li\r\n-                    key={doc.id}\r\n-                    className=\"p-3 bg-gray-100 rounded flex justify-between items-center\"\r\n-                  >\r\n-                    <div>\r\n-                      <p className=\"font-medium\">{doc.file_name}</p>\r\n-                      <p className=\"text-sm text-gray-500\">\r\n-                        {new Date(doc.uploaded_at).toLocaleString()}\r\n-                      </p>\r\n-                      <a\r\n-                        href={doc.file_url}\r\n-                        target=\"_blank\"\r\n-                        rel=\"noopener noreferrer\"\r\n-                        className=\"text-sm text-blue-600 hover:underline\"\r\n+              {/* Liste des documents */}\r\n+              {documents.length === 0 ? (\r\n+                <p className=\"text-gray-500\">Aucun document pour ce client.</p>\r\n+              ) : (\r\n+                <ul className=\"space-y-4\">\r\n+                  {documents.map((doc) => (\r\n+                    <li\r\n+                      key={doc.id}\r\n+                      className=\"bg-gray-50 border border-gray-200 rounded-lg p-4 flex flex-col sm:flex-row\r\n+                                 justify-between items-start sm:items-center shadow-sm\"\r\n+                    >\r\n+                      <div className=\"flex-1\">\r\n+                        <p className=\"text-gray-800 font-medium\">{doc.file_name}</p>\r\n+                        <p className=\"text-sm text-gray-500 mt-1\">\r\n+                          {/* Format de date plus lisible */}\r\n+                          {new Date(doc.uploaded_at).toLocaleDateString(\"fr-FR\", {\r\n+                            day: \"2-digit\",\r\n+                            month: \"long\",\r\n+                            year: \"numeric\",\r\n+                            hour: \"2-digit\",\r\n+                            minute: \"2-digit\",\r\n+                          })}\r\n+                        </p>\r\n+                        <a\r\n+                          href={doc.file_url}\r\n+                          target=\"_blank\"\r\n+                          rel=\"noopener noreferrer\"\r\n+                          className=\"inline-block mt-2 text-sm text-blue-600 hover:underline\"\r\n+                        >\r\n+                          Voir le fichier\r\n+                        </a>\r\n+                      </div>\r\n+                      <button\r\n+                        onClick={() => handleDelete(doc.id)}\r\n+                        className=\"mt-4 sm:mt-0 text-red-600 hover:text-red-800 transition-colors duration-150\r\n+                                   font-medium text-sm\"\r\n                       >\r\n-                        Voir le fichier\r\n-                      </a>\r\n-                    </div>\r\n-                    <button\r\n-                      onClick={() => handleDelete(doc.id)}\r\n-                      className=\"text-red-500 hover:underline text-sm\"\r\n-                    >\r\n-                      Supprimer\r\n-                    </button>\r\n-                  </li>\r\n-                ))}\r\n-              </ul>\r\n-            )}\r\n+                        Supprimer\r\n+                      </button>\r\n+                    </li>\r\n+                  ))}\r\n+                </ul>\r\n+              )}\r\n+            </div>\r\n           </div>\r\n         )}\r\n       </div>\r\n     </div>\r\n-  );\r\n+  </div>\r\n+);\r\n+\r\n }\r\n"
                }
            ],
            "date": 1749066281353,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react'\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nexport default function AdminDashboard() {\r\n  const [clients, setClients] = useState<any[]>([])\r\n  const [selectedClient, setSelectedClient] = useState<any | null>(null)\r\n  const [documents, setDocuments] = useState<any[]>([])\r\n  const [file, setFile] = useState<File | null>(null)\r\n\r\n  // Charger tous les clients\r\n  useEffect(() => {\r\n    const fetchClients = async () => {\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('id, email, first_name, last_name')\r\n\r\n      if (error) console.error('Erreur chargement clients', error)\r\n      else setClients(data || [])\r\n    }\r\n\r\n    fetchClients()\r\n  }, [])\r\n\r\n  // Charger les documents du client sélectionné\r\n  useEffect(() => {\r\n    const fetchDocuments = async () => {\r\n      if (!selectedClient) return\r\n      const { data, error } = await supabase\r\n        .from('user_documents')\r\n        .select('*')\r\n        .eq('user_id', selectedClient.id)\r\n        .order('uploaded_at', { ascending: false })\r\n\r\n      if (error) console.error('Erreur chargement documents', error)\r\n      else setDocuments(data || [])\r\n    }\r\n\r\n    fetchDocuments()\r\n  }, [selectedClient])\r\n\r\n  const handleUpload = async () => {\r\n    if (!file || !selectedClient) return\r\n\r\n    const filePath = `${selectedClient.id}/${file.name}`\r\n    const { data: uploadData, error: uploadError } = await supabase.storage\r\n      .from('documents')\r\n      .upload(filePath, file)\r\n\r\n    if (uploadError) {\r\n      console.error('Erreur upload', uploadError)\r\n      return\r\n    }\r\n\r\n    const { data: publicUrl } = supabase.storage\r\n      .from('documents')\r\n      .getPublicUrl(filePath)\r\n\r\n    const { error: insertError } = await supabase.from('user_documents').insert({\r\n      user_id: selectedClient.id,\r\n      file_name: file.name,\r\n      file_url: publicUrl.publicUrl,\r\n    })\r\n\r\n    if (insertError) {\r\n      console.error('Erreur insertion', insertError)\r\n    } else {\r\n      setFile(null)\r\n      setDocuments(prev => [\r\n        { file_name: file.name, file_url: publicUrl.publicUrl, uploaded_at: new Date().toISOString() },\r\n        ...prev,\r\n      ])\r\n    }\r\n  }\r\n\r\n  const handleDelete = async (docId: string) => {\r\n    const { error } = await supabase.from('user_documents').delete().eq('id', docId)\r\n    if (error) console.error('Erreur suppression', error)\r\n    else setDocuments(prev => prev.filter(doc => doc.id !== docId))\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">Tableau de bord Admin</h1>\r\n\r\n      <div className=\"flex flex-wrap gap-6\">\r\n        <div className=\"w-full md:w-1/3\">\r\n          <h2 className=\"font-semibold mb-2\">Clients</h2>\r\n          <ul className=\"border rounded p-2 h-[400px] overflow-auto\">\r\n            {clients.map(client => (\r\n              <li\r\n                key={client.id}\r\n                className={`p-2 cursor-pointer hover:bg-gray-100 ${\r\n                  selectedClient?.id === client.id ? 'bg-gray-200' : ''\r\n                }`}\r\n                onClick={() => setSelectedClient(client)}\r\n              >\r\n                {client.first_name} {client.last_name} <br />\r\n                <span className=\"text-sm text-gray-600\">{client.email}</span>\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n\r\n        {selectedClient && (\r\n          <div className=\"w-full md:w-2/3\">\r\n            <h2 className=\"font-semibold mb-2\">\r\n              Documents de {selectedClient.first_name} {selectedClient.last_name}\r\n            </h2>\r\n\r\n            <div className=\"mb-4\">\r\n              <input\r\n                type=\"file\"\r\n                onChange={e => setFile(e.target.files?.[0] || null)}\r\n              />\r\n              <button\r\n                className=\"ml-2 px-4 py-1 bg-blue-600 text-white rounded\"\r\n                onClick={handleUpload}\r\n              >\r\n                Upload\r\n              </button>\r\n            </div>\r\n\r\n            {documents.length === 0 ? (\r\n              <p>Aucun document</p>\r\n            ) : (\r\n              <ul className=\"space-y-3\">\r\n                {documents.map(doc => (\r\n                  <li\r\n                    key={doc.id}\r\n                    className=\"p-3 bg-gray-100 rounded flex justify-between items-center\"\r\n                  >\r\n                    <div>\r\n                      <p className=\"font-medium\">{doc.file_name}</p>\r\n                      <p className=\"text-sm text-gray-500\">\r\n                        {new Date(doc.uploaded_at).toLocaleString()}\r\n                      </p>\r\n                      <a\r\n                        href={doc.file_url}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"text-sm text-blue-600 hover:underline\"\r\n                      >\r\n                        Voir le fichier\r\n                      </a>\r\n                    </div>\r\n                    <button\r\n                      onClick={() => handleDelete(doc.id)}\r\n                      className=\"text-red-500 hover:underline text-sm\"\r\n                    >\r\n                      Supprimer\r\n                    </button>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"
        }
    ]
}