{
    "sourceFile": "src/components/Navbar.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1751275912286,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1751275912286,
            "name": "Commit-0",
            "content": "\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Menu, X, User, ChevronDown } from 'lucide-react';\r\nimport MobileMenu from './MobileMenu';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from '@/components/ui/sonner';\r\nimport { Session } from '@supabase/supabase-js';\r\nimport { CartDrawer } from \"@/components/cart/CartDrawer\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuGroup,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuSub,\r\n  DropdownMenuSubTrigger,\r\n  DropdownMenuSubContent,\r\n} from '@/components/ui/dropdown-menu';\r\nimport {\r\n  NavigationMenu,\r\n  NavigationMenuContent,\r\n  NavigationMenuItem,\r\n  NavigationMenuLink,\r\n  NavigationMenuList,\r\n  NavigationMenuTrigger,\r\n  navigationMenuTriggerStyle,\r\n} from \"@/components/ui/navigation-menu\";\r\n\r\nconst Navbar = () => {\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  const [session, setSession] = useState<Session | null>(null);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      (_event, session) => setSession(session)\r\n    );\r\n\r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setSession(session);\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  const toggleMobileMenu = () => {\r\n    setIsMobileMenuOpen(!isMobileMenuOpen);\r\n  };\r\n\r\nconst handleDeleteAccount = async () => {\r\n  const confirm = window.confirm(\r\n    \"⚠️ Voulez-vous vraiment supprimer votre compte ? Il sera désactivé pendant 30 jours.\"\r\n  );\r\n\r\n  if (!confirm) {\r\n    console.log(\"❌ Annulation de l'utilisateur.\");\r\n    return;\r\n  }\r\n\r\n  if (!profile?.id || !profile?.email) {\r\n    console.log(\"❌ Données utilisateur manquantes :\", profile);\r\n    return;\r\n  }\r\n\r\n  console.log(\"🟡 Envoi des données à l’API…\");\r\n\r\n  try {\r\n    const res = await fetch(\r\n      \"https://mon-backend-node.vercel.app/api/disable-account\",\r\n      {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          id: profile.id,\r\n          email: profile.email,\r\n          first_name: profile.first_name,\r\n          last_name: profile.last_name,\r\n        }),\r\n      }\r\n    );\r\n\r\n    console.log(\"📡 Réponse reçue :\", res.status);\r\n\r\n    if (!res.ok) {\r\n      console.error(\"❌ Erreur API :\", await res.text());\r\n      toast({\r\n        title: \"Erreur\",\r\n        description: \"Une erreur est survenue lors de la désactivation.\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    console.log(\"✅ Désactivation réussie, déconnexion en cours…\");\r\n\r\n    toast({\r\n      title: \"Compte désactivé\",\r\n      description: \"Un e-mail de confirmation vous a été envoyé.\",\r\n    });\r\n\r\n    // ✅ Déconnexion\r\n    const { error } = await supabase.auth.signOut();\r\n    if (error) {\r\n      console.error(\"❌ Erreur de déconnexion :\", error.message);\r\n    }\r\n\r\n    navigate(\"/login\");\r\n  } catch (error) {\r\n    console.error(\"❌ Erreur réseau :\", error);\r\n    toast({\r\n      title: \"Erreur réseau\",\r\n      description: \"Impossible de contacter le serveur.\",\r\n      variant: \"destructive\",\r\n    });\r\n  }\r\n};\r\n\r\n\r\n  useEffect(() => {\r\n    setIsMobileMenuOpen(false);\r\n  }, [location.pathname]);\r\n\r\n  return (\r\n    <nav className=\"sticky top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm\">\r\n      <div className=\"container mx-auto px-4 py-3 flex items-center justify-between\">\r\n        <Link to=\"/\" className=\"flex items-center space-x-2\">\r\n          <span className=\"text-2xl font-bold bg-gradient-to-r from-lysco-turquoise to-lysco-pink bg-clip-text text-transparent\">\r\n            Lys&Co\r\n          </span>\r\n        </Link>\r\n\r\n        <div className=\"hidden md:flex items-center space-x-6\">\r\n          <Link to=\"/\" className=\"text-gray-700 hover:text-lysco-turquoise transition-colors\">\r\n            Accueil\r\n          </Link>\r\n          \r\n          <NavigationMenu>\r\n            <NavigationMenuList>\r\n              <NavigationMenuItem>\r\n                <NavigationMenuTrigger className=\"bg-transparent hover:bg-transparent hover:text-lysco-turquoise\">Domiciliation</NavigationMenuTrigger>\r\n                <NavigationMenuContent className=\"bg-white\">\r\n                  <ul className=\"grid gap-3 p-6 md:w-[400px] lg:w-[500px] lg:grid-cols-2\">\r\n                    <li className=\"row-span-3\">\r\n                      <NavigationMenuLink asChild>\r\n                        <Link\r\n                          className=\"flex h-full w-full select-none flex-col justify-end rounded-md bg-gradient-to-b from-lysco-turquoise/20 to-lysco-pink/20 p-6 no-underline outline-none focus:shadow-md\"\r\n                          to=\"/domiciliation\"\r\n                        >\r\n                          <div className=\"mb-2 mt-4 text-lg font-medium\">\r\n                            Services de Domiciliation\r\n                          </div>\r\n                          <p className=\"text-sm leading-tight text-muted-foreground\">\r\n                            Découvrez tous nos services de domiciliation adaptés à votre entreprise.\r\n                          </p>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/1-an-entreprise\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Domiciliation 1 an – Entreprise</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/3-mois-entreprise\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Domiciliation 3 mois – Entreprise</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/3-mois-micro-entreprise\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Domiciliation 3 mois – Micro Entreprise</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/6-mois-entreprise\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Domiciliation 6 mois – Entreprise</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/6-mois-micro-entreprise\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Domiciliation 6 mois – Micro Entreprise</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                    <li>\r\n                      <NavigationMenuLink asChild>\r\n                        <Link to=\"/domiciliation/pack-domicilie\" className=\"block select-none space-y-1 rounded-md p-3 leading-none no-underline outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground\">\r\n                          <div className=\"text-sm font-medium leading-none\">Pack domicilié</div>\r\n                        </Link>\r\n                      </NavigationMenuLink>\r\n                    </li>\r\n                  </ul>\r\n                </NavigationMenuContent>\r\n              </NavigationMenuItem>\r\n            </NavigationMenuList>\r\n          </NavigationMenu>\r\n          \r\n          <Link to=\"/services-admin\" className=\"text-gray-700 hover:text-lysco-turquoise transition-colors\">\r\n            Services Admin\r\n          </Link>\r\n          <Link to=\"/communication\" className=\"text-gray-700 hover:text-lysco-turquoise transition-colors\">\r\n            Communication\r\n          </Link>\r\n          <Link to=\"/contact\" className=\"text-gray-700 hover:text-lysco-turquoise transition-colors\">\r\n            Contact\r\n          </Link>\r\n\r\n          {/* {session && <CartDrawer />} */}\r\n\r\n          {session ? (\r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <Button variant=\"ghost\" size=\"icon\">\r\n                  <User className=\"w-5 h-5 text-lysco-turquoise\" />\r\n                </Button>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"end\">\r\n                <DropdownMenuItem onClick={() => navigate('/dashboard')}>\r\n                  Dashboard\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={handleLogout}>\r\n                  Déconnexion\r\n                </DropdownMenuItem>\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n          ) : (\r\n            <Link to=\"/login\">\r\n              <Button variant=\"outline\" className=\"border-lysco-turquoise text-lysco-turquoise hover:bg-lysco-turquoise hover:text-white\">\r\n                Connexion\r\n              </Button>\r\n            </Link>\r\n          )}\r\n        </div>\r\n\r\n        <button \r\n          className=\"md:hidden text-black\"\r\n          onClick={toggleMobileMenu}\r\n          aria-label=\"Toggle menu\"\r\n        >\r\n          {isMobileMenuOpen \r\n            ? <X size={24} className=\"text-black\" />\r\n            : <Menu size={24} className=\"text-black\" />\r\n          }\r\n        </button>\r\n      </div>\r\n\r\n      {isMobileMenuOpen && <MobileMenu onClose={toggleMobileMenu} session={session} />}\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default Navbar;\r\n"
        }
    ]
}